# ğŸ“¸ MEMORY FEED PAGE - COMPLETE ZERO-KNOWLEDGE HANDOFF

**Route:** `/memory-feed` (ESAMemoryFeed.tsx)  
**Generated:** November 6, 2025  
**Methodology:** MB.MD (Simultaneously, Recursively, Critically)  
**Source:** GitHub branch `conflict_100925_1852`  
**Total Lines:** 2,654+ across all components

---

## ğŸ“‹ TABLE OF CONTENTS

1. [Overview](#overview)
2. [Page Architecture](#page-architecture)
3. [PostCreator Component (1,731 lines)](#postcreator-component)
4. [SmartPostFeed Component (160 lines)](#smartpostfeed-component)
5. [Sidebar Components](#sidebar-components)
6. [UpcomingEventsSidebar (211 lines)](#upcomingeventssidebar)
7. [Real-Time Features](#real-time-features)
8. [Recommendations System](#recommendations-system)
9. [Feed Ranking Algorithm](#feed-ranking-algorithm)
10. [User Content Preferences](#user-content-preferences)
11. [Algorithms & Automations](#algorithms--automations)
12. [Complete Feature List](#complete-feature-list)
13. [APIs & Database](#apis--database)

---

## ğŸ¯ OVERVIEW

### What Is Memory Feed?

The Memory Feed is the **main home page** (`/memory-feed`) of the Mundo Tango platform, featuring:
- Universal post creation with 6 animated icon buttons
- Real-time social feed with AI-powered ranking algorithm
- Filters and search capabilities
- Upcoming tango events sidebar
- Hidden gems recommendations system
- User content preferences (adjustable algorithm weights)
- MT Ocean Theme glassmorphic design

### Key Clarification

**Memory Feed = News Feed with Memory Branding**
- Uses standard `posts` table (NOT separate memories system)
- API: `/api/posts` (NOT `/api/memories`)
- Same social features (like/comment/share)
- Memory-themed UI/translations for storytelling feel

---

## ğŸ—ï¸ PAGE ARCHITECTURE

### Layout Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MT OCEAN THEME GLASSMORPHIC HEADER                         â”‚
â”‚  "Memories" Title + Live Badge + Keyboard Shortcuts          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MAIN FEED (Left)        â”‚  SIDEBAR (Right - Desktop Only)  â”‚
â”‚  â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼   â”‚  â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼  â”‚
â”‚                          â”‚                                  â”‚
â”‚  1. PostCreator          â”‚  1. UpcomingEventsSidebar        â”‚
â”‚     (1,731 lines)        â”‚     (211 lines)                  â”‚
â”‚     - 6 Icon Buttons     â”‚     - RSVP'd Events              â”‚
â”‚     - Media Upload       â”‚     - Your City Events           â”‚
â”‚     - Recommendations    â”‚     - Events You Follow          â”‚
â”‚     - AI Enhancement     â”‚     - Cities You Follow          â”‚
â”‚     - Visibility         â”‚                                  â”‚
â”‚                          â”‚  2. Ads                          â”‚
â”‚  2. SmartPostFeed        â”‚     (Planned)                    â”‚
â”‚     (160 lines)          â”‚                                  â”‚
â”‚     - Filters            â”‚                                  â”‚
â”‚     - Search             â”‚                                  â”‚
â”‚     - Infinite Scroll    â”‚                                  â”‚
â”‚     - Like/Comment       â”‚                                  â”‚
â”‚     - Share/Edit         â”‚                                  â”‚
â”‚     - Real-time Updates  â”‚                                  â”‚
â”‚                          â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MrBlueMemoriesButton (Floating AI Companion)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### File: `client/src/pages/ESAMemoryFeed.tsx` (577 lines)

**Imports:**
```typescript
// Core Components
- PostCreator from '@/components/universal/PostCreator'
- SmartPostFeed from '@/components/moments/SmartPostFeed'
- UpcomingEventsSidebar from '@/components/esa/UpcomingEventsSidebar'
- MrBlueMemoriesButton from '@/components/mrBlue/MrBlueMemoriesButton'

// Real-time
- useMemoriesFeed from '@/hooks/useMemoriesFeed' (Socket.IO)

// UI/UX
- GlassCard from '@/components/glass/GlassComponents'
- FadeIn from '@/components/animations/FramerMotionWrappers'
- DashboardLayout from '@/layouts/DashboardLayout'

// Resilience
- withResilience from '@/components/resilient/ResilientBoundary'
```

---

## ğŸ¨ POSTCREATOR COMPONENT (1,731 lines)

**File:** `client/src/components/universal/PostCreator.tsx`

### Purpose
Universal post creation component used across Memory Feed, Events, Groups, and other contexts.

### The 6 Animated Icon Buttons

#### Button Layout (Left to Right):

```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1  â”‚  2  â”‚  3  â”‚  4  â”‚  5  â”‚      6      â”‚
â”‚ ğŸ—ºï¸  â”‚  #  â”‚ ğŸ“·  â”‚ âœ¨  â”‚ ğŸŒ  â”‚   SHARE     â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Hidden  Tags Camera AI   Vis-   Share Memory
 Gems              Enh  ibility   (Large BTN)
```

#### 1. ğŸ—ºï¸ **Hidden Gems (Recommendations)**
**Icon:** `MapPin`  
**Colors:** Amber/Orange gradient  
**Animation:** Pin drop on hover, pulse when active  
**Tooltip:** "Hidden Gems - Share your favorite places"

**Features:**
- Toggle recommendation mode
- When active, shows recommendation panel with:
  - **Category selector** (Restaurant, CafÃ©, Hotel, Tango Venue, Activity)
  - **Price range** (4 options: $, $$, $$$, $$$$)
  - **Location picker** (Google Maps integration)
  - Glassmorphic design with MT Ocean Theme

**Categories:**
```typescript
- Restaurant ğŸ½ï¸
- CafÃ© â˜•
- Hotel ğŸ¨
- Tango Venue ğŸ’ƒ
- Activity ğŸ¯
```

**Price Ranges:**
```typescript
- $ (Budget-friendly)
- $$ (Moderate)
- $$$ (Upscale)
- $$$$ (Luxury)
```

#### 2. # **Tags**
**Icon:** `Hash`  
**Colors:** Turquoise/Cyan gradient  
**Animation:** Rotate 180Â° when active, flip on hover  
**Tooltip:** "Add Tags - Categorize your memory"

**Features:**
- 15 predefined tag categories
- Multi-select tags with emoji indicators
- Glassmorphic tag pills

**Available Tags (Toggle Buttons):**

When user clicks the Tags button (#), a panel appears with 15 **clickable toggle buttons**:

```typescript
1. âœˆï¸ Travel       9. âš½ Sports
2. ğŸ• Food        10. ğŸ“¸ Photography
3. ğŸ­ Culture     11. ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Family
4. ğŸ”ï¸ Adventure   12. ğŸ‘¥ Friends
5. ğŸŒƒ Nightlife   13. ğŸ’¼ Work
6. ğŸŒ¿ Nature      14. ğŸ¯ Milestone
7. ğŸ¨ Art         15. ğŸ‰ Celebration
8. ğŸµ Music
```

**UI Behavior:**
- User clicks tag buttons to toggle on/off
- Selected tags show gradient background (turquoise â†’ cyan)
- Unselected tags show white/light background
- Multi-select allowed (select as many as desired)
- Tags array saved with post

#### 3. ğŸ“· **Camera (Media Upload)**
**Icon:** `Camera`  
**Colors:** Blue/Purple gradient  
**Animation:** Camera shutter effect on hover  
**Tooltip:** "Upload Media - Share photos & videos"

**Features:**
- **Internal media upload** system
- Support for images AND videos
- **30 files max**, **500MB each**
- Client-side compression
- Video thumbnail extraction
- Preview with delete button
- Progress indicator during upload

**Supported Formats:**
- Images: JPG, PNG, GIF, WebP
- Videos: MP4, WebM, MOV

#### 4. âœ¨ **AI Enhancement**
**Icon:** `Sparkles`  
**Colors:** Purple/Pink gradient  
**Animation:** Spin when processing, twinkle on hover  
**Tooltip:** "AI Enhance - Improve your content"

**Features:**
- AI-powered content improvement
- Automatic sentiment analysis
- Engagement optimization
- Shows enhanced preview before publishing
- Uses OpenAI GPT-4o

**AI Enhancements:**
```typescript
- Enhanced content (rewritten/improved)
- Generated tags
- Sentiment analysis (positive/neutral/negative)
- Engagement optimization suggestions
```

#### 5. ğŸŒ **Visibility**
**Icon:** `Globe` / `Users` / `Lock`  
**Colors:** Green/Emerald gradient  
**Animation:** Globe spin effect  
**Tooltip:** "Visibility - Who can see this"

**Features:**
- 3 visibility levels
- Icon changes based on selection
- Glassmorphic selection grid

**Visibility Options:**
```typescript
1. ğŸŒ Public - Everyone can see
2. ğŸ‘¥ Friends - Friends only
3. ğŸ”’ Private - Only me
```

#### 6. **Share Memory (Large Button)**
**Icon:** `Send` / `Loader` (when uploading)  
**Colors:** Turquoise/Cyan/Blue gradient  
**Animation:** Pulsing glow when ready, shimmer effect on hover, send-fly animation  
**Size:** Larger than other buttons (prominent)  
**Tooltip:** "Share Memory - Share with community"

**Features:**
- Disabled when no content
- Shows loader when submitting
- Pulsing glow ring when ready to post
- Animated shimmer overlay on hover
- Handles both FormData and JSON submissions

### Additional PostCreator Features

#### @Mentions System
- Type `@` to trigger autocomplete
- Search users in real-time
- Click to insert mention
- Extracted and saved with post

#### Location Picker (UnifiedLocationPicker)
- **Google Maps** integration
- Place autocomplete
- Business details (name, rating, address)
- Coordinates saved
- Shows location chip after selection

#### Rich Text Content
- SimpleMentionsInput component
- Supports @mentions inline
- Plain text + rich content stored

#### Media Management
**Three upload strategies:**
1. **Internal upload** - Direct to server (/api/upload)
2. **Cloudinary** - CDN storage
3. **External URLs** - YouTube/Vimeo embeds

#### Edit Mode
- Pre-fills existing post data
- Shows existing media
- Updates instead of creates
- Used in edit modal

#### Context-Aware Posting
Can be used in different contexts:
```typescript
context: {
  type: 'feed' | 'event' | 'group' | 'memory',
  id?: string,
  name?: string
}
```

### PostCreator State Management

```typescript
// Content
- content: string (plain text)
- richContent: string (with formatting)
- mentions: string[] (user IDs)

// Media
- mediaFiles: File[] (local files)
- mediaPreviews: string[] (preview URLs)
- internalMediaUrls: string[] (uploaded URLs)
- cloudMediaUrls: string[] (Cloudinary URLs)
- uploadProgress: number
- isUploading: boolean

// Features
- isRecommendation: boolean
- recommendationType: string
- priceRange: string
- location: string
- locationCoordinates: {lat, lng}
- selectedTags: string[]
- visibility: 'public' | 'friends' | 'private'

// AI
- isEnhancing: boolean
- enhancedContent: string
- showEnhancement: boolean

// UI
- showTags: boolean
- showVisibility: boolean
- showAdvanced: boolean
```

### PostCreator Animations

**Icon Entrance Animation:**
```css
@keyframes iconEntrance {
  from { opacity: 0; transform: scale(0.3) rotate(-45deg); }
  to { opacity: 1; transform: scale(1) rotate(0deg); }
}
```

**Staggered delays:**
- Button 1 (Hidden Gems): 0s
- Button 2 (Tags): 0.1s
- Button 3 (Camera): 0.2s
- Button 4 (AI): 0.3s
- Button 5 (Visibility): 0.4s
- Button 6 (Share): 0.5s

**Interactive Effects:**
- Ripple effect on button hover (siblings bounce)
- Magnetic button attraction
- Shimmer overlay on share button
- Pulsing glow when ready to post

---

## ğŸ“° SMARTPOSTFEED COMPONENT (160 lines)

**File:** `client/src/components/moments/SmartPostFeed.tsx`

### Purpose
Smart container component that fetches and displays posts with filtering, search, and real-time updates.

### Architecture
**Smart/Container Pattern:**
- Fetches data automatically based on context
- Manages state (page, filters, search)
- Delegates rendering to `ControlledPostFeed`

### Features

#### 1. **Search** (Optional)
- Real-time search as you type
- 300ms debounce for performance
- Searches post content
- Resets to page 1 on new search

#### 2. **Filters** (Optional)
**Filter Types:**
```typescript
- All posts
- Residents (users who live in the city)
- Visitors (tourists/travelers)
- Friends (friends' posts only)
```

**Tag Filters:**
- Add/remove tags
- Filter by multiple tags simultaneously
- Shows active tags with remove button

**Date Filters:**
- Start date
- End date
- Filter posts by date range

#### 3. **Infinite Scroll**
- Loads 20 posts per page
- Auto-loads next page on scroll
- Shows loading indicator
- Stops when no more posts

#### 4. **Post Interactions**
**Available Actions:**
- â¤ï¸ Like/Unlike
- ğŸ’¬ Comment
- ğŸ”„ Share
- âœï¸ Edit (own posts)
- ğŸ—‘ï¸ Delete (own posts, with confirmation)

#### 5. **Real-Time Updates**
- Socket.IO integration
- Live post creation
- Live likes/comments
- Connection status indicator

### Data Management

**Custom Hooks:**
```typescript
// Data fetching
usePostFeed({
  context,      // feed/event/group/memory
  page,         // Current page number
  limit,        // Posts per page (20)
  filters,      // Filter options
  searchQuery   // Search term
})

// Mutations
usePostMutations(context) // Returns like/delete functions
```

### State Management

```typescript
// Pagination
- page: number (current page)
- hasMore: boolean (more posts available)

// Search & Filters
- searchQuery: string
- filterBy: 'all' | 'residents' | 'visitors' | 'friends'
- filterTags: string[]
- startDate: string
- endDate: string

// Loading States
- isLoading: boolean (initial load)
- isFetching: boolean (loading more)
```

### Props Configuration

```typescript
<SmartPostFeed
  context={{ type: 'feed' }}  // Required
  showFilters={true}           // Optional, default false
  showSearch={true}            // Optional, default false
  onEdit={(post) => {...}}     // Optional edit handler
  className="custom-styles"    // Optional CSS classes
  emptyMessage="Custom message" // Optional empty state
/>
```

---

## ğŸ“Š SIDEBAR COMPONENTS

### Right Sidebar Layout (Desktop Only)

The right sidebar contains **2 components only**:

1. **UpcomingEventsSidebar** (211 lines) - See detailed section below
2. **Ads** (Planned feature - not yet implemented)

**Note:** `GlobalStatisticsDashboard` is NOT in the sidebar. It appears elsewhere in the platform but NOT on the Memory Feed page.

---

## ğŸ“… UPCOMINGEVENTSSIDEBAR (211 lines)

**File:** `client/src/components/esa/UpcomingEventsSidebar.tsx`

### Purpose
Displays upcoming tango events organized by relevance to user.

### Event Categories (Priority Order)

#### 1. **RSVP'd Events** (Highest Priority)
- Events user has RSVP'd to
- Status: Going, Interested, or Maybe
- Always shown first
- Collapsible section

#### 2. **Your City Events**
- Events in user's city
- Excludes RSVP'd events
- Limited to 3 events
- TODO: Get user's actual city (currently hardcoded to Barcelona)

#### 3. **Events You Follow**
- Events from groups/organizers user follows
- Excludes events from above categories
- Limited to 3 events
- TODO: Implement follow tracking

#### 4. **Cities You Follow**
- Events in cities user follows
- Currently: Buenos Aires, Paris, Milan (TODO: Get from user prefs)
- Excludes events from above categories
- Limited to 3 events

### Event Data Structure

```typescript
interface Event {
  id: string
  title: string
  type: 'milonga' | 'workshop' | 'festival' | 'practica'
  date: string
  time: string
  location: string
  city?: string
  attendees: number
  userRsvpStatus?: 'going' | 'interested' | 'maybe' | 'not_going' | null
  isFeatured?: boolean
}
```

### Features

#### UnifiedEventCard Display
Each event shown as:
- Event type badge (milonga/workshop/festival/practica)
- Title
- Date and time
- Location
- Attendee count
- RSVP buttons (if not already RSVP'd)

#### Collapsible Sections
- Click section header to expand/collapse
- Shows event count badge
- ChevronUp/ChevronDown icons
- Persists expansion state

#### Real-Time RSVP
- RSVP mutation hook (`useEventRSVP`)
- Instant UI update
- Invalidates query cache
- Socket.IO event broadcast

### API Integration

```typescript
GET /api/events/feed?limit=20&visibility=public
```

**Query Config:**
- Auto-refetch on mount (`staleTime: 0`)
- No structural sharing (for real-time updates)
- Includes credentials

### Styling
- MT Ocean Theme colors
- Glassmorphic section headers (`rgba(209,250,250,0.65)`)
- Hover effects on headers
- Responsive spacing
- Loading skeleton during fetch

---

## ğŸ”´ REAL-TIME FEATURES

### Socket.IO Integration

**Hook:** `useMemoriesFeed()` from `@/hooks/useMemoriesFeed`

**Connection Status:**
```typescript
connectionStatus: 'connected' | 'disconnected' | 'reconnecting'
```

**Status Badge (Header):**
- âœ… **Connected:** Green "Live" badge with `Wifi` icon
- â³ **Disconnected:** Gray "Connecting..." with `WifiOff` icon
- Animated pulse effect when connected

### Real-Time Events

**Post Creation:**
```typescript
socket.emit('memory:created', {
  memoryId: number,
  userId: number,
  username: string,
  content: string
})
```

**Post Likes:**
```typescript
socket.emit('memory:liked', {
  memoryId: number,
  userId: number,
  username: string,
  memoryOwnerId: number
})
```

**Live Feed Updates:**
- New posts appear instantly
- Like counts update in real-time
- Comment counts update live
- Auto-invalidates React Query cache

### Toast Notifications

**New Post:**
```
"[Username] shared a new memory!"
Gradient: turquoise â†’ teal
```

**Post Liked:**
```
"[Username] liked your memory!"
Gradient: pink â†’ purple
```

**Error:**
```
"Failed to [action]"
Gradient: red
```

---

## ğŸ—ºï¸ RECOMMENDATIONS SYSTEM

### Activation
Click the **Hidden Gems** icon button (ğŸ—ºï¸ MapPin) in PostCreator.

### Recommendation Panel (Glassmorphic)

**Background:** Ocean gradient with blur  
**Border:** Turquoise with glow  
**Animation:** Slide-in-from-top

### Fields

#### 1. Category Selector
**Dropdown with Icons:**
```
ğŸ“ Select a category...
ğŸ½ï¸ Restaurant
ğŸ¸ Bar
â˜• CafÃ©
ğŸ¨ Hotel
ğŸ’ƒ Tango Venue
ğŸ¯ Activity
```

#### 2. Price Range (4 Buttons)
```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  $  â”‚ $$  â”‚ $$$ â”‚$$$$ â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
Budget Moderate Upscale Luxury
```

**Visual States:**
- Selected: Gradient fill + white text
- Unselected: White background + gray text
- Hover: Scale up + glow

#### 3. Location Picker
**Google Maps Integration:**
- Place autocomplete
- Business search
- Details: name, rating, address, coordinates
- Location icon with selected place name

### Data Saved with Post

```typescript
{
  isRecommendation: true,
  recommendationType: 'restaurant' | 'cafe' | 'hotel' | 'venue' | 'activity',
  priceRange: '$' | '$$' | '$$$' | '$$$$',
  location: string,
  locationCoordinates: { lat: number, lng: number },
  locationDetails: {
    name: string,
    rating: number,
    address: string,
    types: string[]
  }
}
```

### Backend Handling

**API:** `POST /api/posts`

```typescript
if (isRecommendation) {
  // Create recommendation entry
  // Link to post
  // Add to recommendations feed
  // Geocode for map display
}
```

---

## ğŸ¤– ALGORITHMS & AUTOMATIONS

### 1. Advanced Media Processing Algorithm

**File:** `client/src/utils/advancedMediaProcessor.ts` (549 lines)

#### Universal Format Detection
```typescript
detectMediaType(file) â†’ {
  type: 'image' | 'video' | 'audio' | 'unknown'
  format: string
  needsConversion: boolean
  targetFormat?: string
}
```

**Supported Formats:**
- **HEIC/HEIF** (iPhone photos) â†’ Convert to JPEG
- **MOV/QuickTime** (iPhone videos) â†’ Compress to MP4
- **RAW formats** (.cr2, .nef, .arw, .dng, .orf, .rw2) â†’ Convert to JPEG
- **Standard images** (JPG, PNG, GIF, WebP) â†’ Smart compression
- **Standard videos** (MP4, WebM) â†’ Hardware-accelerated compression

#### Processing Pipeline

**For HEIC Images:**
```typescript
1. Detect HEIC format
2. Convert to JPEG (heic2any library, 90% quality)
3. Smart compress (see below)
4. Return optimized JPEG
```

**For Images (Standard + RAW):**
```typescript
1. Load image into Canvas
2. Calculate optimal dimensions (max 1920px)
3. Draw at new dimensions
4. Convert to JPEG with quality 0.8
5. If still > 1MB, retry with quality 0.64
6. Return compressed image
```

**For Videos (MOV, MP4, WebM):**
```typescript
1. Check for WebCodecs API (hardware acceleration)
2. If available:
   - Configure VP9 encoder (1 Mbps bitrate, 30fps)
   - Scale to max 1080x1920 (Instagram dimensions)
   - Process frames with hardware acceleration
   - Create WebM blob
3. If unavailable:
   - Use MediaRecorder fallback
   - Capture at 1 Mbps
   - Create compressed video
```

#### Smart Compression Algorithm

```typescript
compressImageSmart(file) {
  1. Check file size
  2. If < 1MB: minimal compression (quality 0.9)
  3. If 1-5MB: standard compression (quality 0.8)
  4. If > 5MB: aggressive compression (quality 0.7)
  5. Scale dimensions if needed (max 1920px)
  6. Iterative quality reduction if still too large
  7. Return optimized file
}
```

**Compression Results:**
- Average reduction: 60-80%
- HEIC 4MB â†’ JPEG 800KB
- MOV 50MB â†’ MP4 8MB

#### Chunked Upload Strategy (Large Files)

**File:** `client/src/utils/chunkedUpload.ts`

```typescript
For files > 10MB:
1. Split into 5MB chunks
2. Upload chunks in parallel (3 at a time)
3. Track progress per chunk
4. Resume if interrupted (Facebook-style)
5. Server assembles chunks
6. Return final URL
```

**Benefits:**
- No memory crashes
- Resumable uploads
- Better progress tracking
- Handles network interruptions

---

### 2. Event Prioritization Algorithm

**File:** `client/src/components/esa/UpcomingEventsSidebar.tsx`

#### 4-Tier Categorization

**Priority 1: RSVP'd Events** (Highest)
```typescript
filter: userRsvpStatus in ['going', 'interested', 'maybe']
sort: by date (ascending)
display: all RSVP'd events
```

**Priority 2: Your City Events**
```typescript
filter: city === userCity && not in RSVP'd
limit: 3 events
sort: by date (ascending)
display: next 3 events in user's city
```

**Priority 3: Events You Follow**
```typescript
filter: from followed groups/organizers && not in above
limit: 3 events
sort: by date (ascending)
display: next 3 events from followed sources
```

**Priority 4: Cities You Follow**
```typescript
filter: city in followedCities && not in above
cities: Buenos Aires, Paris, Milan (TODO: user prefs)
limit: 3 events
sort: by date (ascending)
display: next 3 events from followed cities
```

#### Collapsible Sections
- Each category is collapsible
- Event count badge shows total per category
- Expand/collapse state persisted in component state

---

### 3. Feed Filtering & Search Algorithm

**File:** `client/src/components/moments/SmartPostFeed.tsx`

#### Search Algorithm
```typescript
1. User types query
2. 300ms debounce (prevent excessive API calls)
3. Query sent to backend
4. Backend searches:
   - Post content (full-text search)
   - Hashtags (exact match)
   - User names (partial match)
   - Location (partial match)
5. Results returned sorted by relevance
6. Feed re-renders with results
```

#### Filter Algorithm

**Filter Types:**
```typescript
'all':       No filtering (all posts)
'residents': posts.userId IN (users where isResident = true)
'visitors':  posts.userId IN (users where isResident = false)
'friends':   posts.userId IN (friends of current user)
```

**Tag Filtering:**
```typescript
- Multi-select tags (AND logic)
- Example: #Travel + #Food = posts with BOTH tags
- Server filters: posts.hashtags @> ['travel', 'food']
```

**Date Range:**
```typescript
startDate: posts.createdAt >= startDate
endDate: posts.createdAt <= endDate
```

**Combined Filters:**
```typescript
All filters applied with AND logic:
  filterType AND tags AND dateRange
```

#### Pagination Algorithm
```typescript
Infinite Scroll:
1. Initial load: 20 posts
2. User scrolls to bottom
3. Trigger onLoadMore when 80% scrolled
4. Fetch next page (page++)
5. Append to existing posts
6. Repeat until hasMore = false

Optimizations:
- Debounce scroll event (100ms)
- Only fetch if not already fetching
- Show loading indicator during fetch
```

---

### 4. AI Enhancement Algorithm

**File:** `client/src/components/universal/PostCreator.tsx`  
**API:** `POST /api/posts/enhance-content`

#### Processing Pipeline

```typescript
User clicks AI Enhancement button âœ¨

1. Validate content exists
2. Send to backend:
   POST /api/posts/enhance-content
   Body: { content: string }

3. Backend (GPT-4o):
   - Analyze sentiment
   - Improve grammar/clarity
   - Optimize for engagement
   - Generate relevant hashtags
   - Suggest improvements

4. Return enhanced version:
   {
     enhanced: string,           // Improved content
     tags: string[],            // Suggested hashtags
     sentiment: 'positive' | 'neutral' | 'negative',
     suggestions: string[]      // Improvement notes
   }

5. Show preview modal:
   - Original vs Enhanced comparison
   - User can accept or reject
   - If accepted, replace content
```

**Enhancement Rules:**
- Preserve user's voice/style
- Fix grammar/spelling
- Add emotion where appropriate
- Suggest 3-5 relevant hashtags
- Optimize readability

---

### 5. Real-Time Synchronization Automation

**Hook:** `useMemoriesFeed()` from `@/hooks/useMemoriesFeed`

#### Socket.IO Event Flow

**Post Creation:**
```typescript
Client A creates post
  â†“
Client A: socket.emit('memory:created', data)
  â†“
Server: broadcast to all connected clients
  â†“
Clients B, C, D: receive 'memory:new' event
  â†“
Auto-invalidate React Query cache
  â†“
Feed refreshes with new post
```

**Like/Comment:**
```typescript
User clicks like
  â†“
Optimistic UI update (instant feedback)
  â†“
API: POST /api/posts/:id/like
  â†“
Socket.IO: broadcast 'memory:liked'
  â†“
Post owner receives notification
  â†“
All viewers see updated like count
```

**Connection Management:**
```typescript
Auto-reconnection:
1. Detect disconnect
2. Show "Connecting..." badge
3. Exponential backoff retry (1s, 2s, 4s, 8s)
4. Resume on reconnection
5. Sync missed events
```

---

### 6. Media Upload Strategy Algorithm

**File:** `client/src/utils/advancedMediaProcessor.ts`

#### Decision Tree

```typescript
function getUploadStrategy(file) {
  const sizeMB = file.size / 1024 / 1024;
  
  if (sizeMB < 1) {
    return 'direct';      // Direct upload, minimal processing
  }
  
  if (sizeMB < 10) {
    return 'compress';    // Compress then upload
  }
  
  if (sizeMB < 50) {
    return 'chunked';     // Chunked upload (5MB chunks)
  }
  
  return 'progressive';   // Progressive upload with streaming
}
```

**Strategy Execution:**

**Direct Upload (<1MB):**
```typescript
1. Minimal compression
2. Upload to /api/upload
3. Return URL immediately
```

**Compress Upload (1-10MB):**
```typescript
1. Smart compression algorithm
2. Progress callback (0-60%: compress, 60-100%: upload)
3. Upload compressed file
4. Return URL
```

**Chunked Upload (10-50MB):**
```typescript
1. Compress first (if possible)
2. Split into 5MB chunks
3. Upload 3 chunks in parallel
4. Progress: (chunksUploaded / totalChunks) * 100
5. Server assembles chunks
6. Return URL
```

**Progressive Upload (>50MB):**
```typescript
1. Stream to server in chunks
2. Server processes while receiving
3. Real-time progress updates
4. Fallback to chunked if streaming fails
```

---

### 7. Recommendation Geocoding Automation

**When user creates recommendation:**

```typescript
1. User selects place via Google Maps
2. Extract coordinates: { lat, lng }
3. Save to database with post
4. Background job (async):
   - Geocode reverse lookup
   - Get full address
   - Assign to city group
   - Add to map layer
5. Recommendation appears on Tango Community Map
```

**Automation Triggers:**
- Post creation with `isRecommendation: true`
- Location update on existing recommendation
- Bulk import of recommendations

---

### 8. Performance Optimization Algorithms

#### Debouncing
```typescript
// Search input
useDebounce(searchQuery, 300ms)
  â†’ Prevents API spam
  â†’ Only searches after user stops typing

// Scroll events
throttle(onScroll, 100ms)
  â†’ Prevents excessive scroll handlers
  â†’ Checks scroll position every 100ms
```

#### Caching Strategy
```typescript
React Query Configuration:
- staleTime: 30s (statistics)
- staleTime: 0 (real-time feed)
- cacheTime: 5 minutes
- refetchOnWindowFocus: true
- retry: 3 (with exponential backoff)

Cache Invalidation:
- On mutation: invalidate related queries
- On Socket.IO event: selective invalidation
- Manual: user-triggered refresh
```

#### Lazy Loading
```typescript
Components:
- UpcomingEventsSidebar: lazy loaded
- ShareModal: lazy loaded with Suspense
- Mr. Blue button: lazy loaded

Images:
- loading="lazy" attribute
- Intersection Observer
- Progressive image loading (blur-up)
```

#### Code Splitting
```typescript
Dynamic imports:
- Route-based: each page is separate chunk
- Component-based: modals, heavy components
- Library splitting: vendor bundle optimization
```

---

### 9. Retry Logic with Exponential Backoff

**File:** `client/src/utils/retryLogic.ts`

```typescript
async function withRetry(fn, maxRetries = 3) {
  let attempt = 0;
  
  while (attempt < maxRetries) {
    try {
      return await fn();
    } catch (error) {
      attempt++;
      
      if (attempt >= maxRetries) {
        throw error;
      }
      
      // Exponential backoff: 1s, 2s, 4s
      const delay = Math.pow(2, attempt) * 1000;
      await sleep(delay);
    }
  }
}

Usage:
- API calls
- Socket.IO reconnection
- Media upload failures
- Database queries
```

---

### 10. Mention Parsing Algorithm

**File:** `client/src/utils/mentionUtils.ts`

```typescript
extractMentions(content: string) {
  1. Regex pattern: /@(\w+)/g
  2. Extract all matches
  3. For each match:
     - Query users table
     - Match by username
     - Return user ID
  4. Return array of user IDs
  5. Store in post.mentions
  6. Send notification to mentioned users
}

Example:
"Had a great time with @pierre @maria at the milonga!"
  â†“
['user_123', 'user_456']
  â†“
Notifications sent to Pierre and Maria
```

---

### 11. Auto-Statistics Update Automation

**GlobalStatisticsDashboard:**

```typescript
Main Stats:
  - Fetch interval: 30 seconds
  - Query: /api/statistics/global
  - Auto-invalidate on user actions

Real-time Activity:
  - Fetch interval: 10 seconds
  - Query: /api/statistics/realtime
  - Shows last 24 hours data

Calculation:
  - Server aggregates on query
  - Cached for 10-30 seconds
  - Incremental updates only
```

---

### 12. Responsive Image Generation

**File:** `client/src/utils/imageOptimizer.ts`

```typescript
generateResponsiveImages(file) {
  Parallel generation of 5 sizes:
  
  1. Thumbnail: 150x150px @ 0.8 quality
  2. Small: 400x400px @ 0.85 quality
  3. Medium: 800x800px @ 0.85 quality
  4. Large: 1200x1200px @ 0.9 quality
  5. Original: 1920px max @ 0.95 quality
  
  Benefits:
  - Faster page loads
  - Bandwidth savings
  - Better mobile experience
  - Automatic srcset generation
}
```

---

## ğŸ¯ FEED RANKING ALGORITHM

**File:** `mundo-tango-repo/server/services/memoriesFeedAlgorithm.ts` (640+ lines)

### Purpose
Sophisticated AI-powered memory curation system that surfaces the most meaningful content based on temporal patterns, social connections, emotional resonance, and personal growth.

### Scoring System (100 points total)

Posts are ranked by a **4-component scoring algorithm**:

#### 1. **Temporal Score** (0-30 points)
**Weights memories based on time significance:**

```typescript
"On This Day" memories (same date, 1-5 years ago):
  - 1 year ago: +30 points
  - 2-5 years ago: +25 points
  - 5+ years ago: +15 points

Seasonal memories (same month, different year):
  - +8 points

Weekly anniversaries (every 7 days, within 1 year):
  - +5 points

Fresh content (within last 7 days):
  - +3 points
```

#### 2. **Social Score** (0-25 points)
**Weights based on friendship connections:**

```typescript
Close friends (80%+ closeness):
  - +15 points

Good friends (60-79% closeness):
  - +10 points

Regular friends (40-59% closeness):
  - +5 points

@Mentions:
  - +3 points per mention (max 10)

Popular in network (>10 likes):
  - +5 points

Comments (meaningful conversation):
  - +2 points per comment (max 8)
```

#### 3. **Emotional Score** (0-25 points)
**Weights based on sentiment and emotional resonance:**

```typescript
Achievement/Milestone keywords:
  - graduated, promoted, married, birthday, etc.
  - +15 points

Positive emotion keywords:
  - happy, joy, love, amazing, wonderful, etc.
  - +3 points per keyword (max 12)

Travel/Adventure keywords:
  - vacation, trip, travel, adventure, etc.
  - +8 points

Family/Relationship keywords:
  - family, mom, dad, sister, brother, etc.
  - +6 points

High engagement (>15 total interactions):
  - +10 points

Moderate engagement (5-15 interactions):
  - +5 points
```

#### 4. **Content Score** (0-20 points)
**Weights based on content richness:**

```typescript
Media content (images/videos):
  - +8 points

Video content (more engaging):
  - +5 points additional

Location tagged:
  - +4 points

Detailed content (>200 characters):
  - +3 points
```

### Diversity Filters

**Prevents same-day/week dominance:**

```typescript
Max 2 memories per day
Max 3 memories per week
Ensures temporal variety in feed
```

### User Preference Weights

Users can adjust algorithm emphasis:

```typescript
{
  temporalWeight: 1.0,    // "On this day" emphasis
  socialWeight: 1.0,      // Social connection emphasis
  emotionalWeight: 1.0,   // Emotional content emphasis
  contentWeight: 0.8,     // Media richness emphasis
  minimumScore: 10        // Minimum score threshold
}
```

### Filter Options

**3 Filter Types:**

```typescript
1. 'all': User's own posts + friend posts
2. 'following': Only posts from friends
3. 'nearby': Posts within geographic radius
```

**Additional Filters:**

```typescript
- Tags: Filter by hashtags (AND logic)
- Visibility: public/friends/private
- Location: Geographic radius filter
```

### Example Calculation

**Post: "Happy birthday celebration with family! ğŸ‰"**
- Posted 1 year ago today
- Has 15 likes, 5 comments
- Contains: birthday, happy, family
- Has 3 photos

```
Temporal: +30 (1 year ago today)
Social: +5 (popular) + 10 (comments) = +15
Emotional: +15 (birthday) + 3 (happy) + 6 (family) = +24
Content: +8 (photos) + 3 (detailed) = +11
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total Score: 80 points (High priority!)
```

### API Implementation

```typescript
POST /api/memories/feed
Body: {
  userId: number,
  limit: 20,
  preferences: {
    temporalWeight: 1.0,
    socialWeight: 1.0,
    emotionalWeight: 1.0,
    contentWeight: 0.8
  },
  filters: {
    filterType: 'all' | 'following' | 'nearby',
    tags: string[],
    visibility: 'all' | 'public' | 'friends' | 'private',
    location: { lat, lng, radius }
  }
}

Returns: {
  memories: Post[],
  algorithm: {
    processed: number,      // Posts analyzed
    scored: number,         // Posts that met threshold
    topScores: Score[],     // Top 10 scores with breakdown
    filtersApplied: filters
  }
}
```

---

## ğŸ‘¤ USER CONTENT PREFERENCES

**Database Tables:**
- `aiUserPreferences` (AI preferences)
- `userViewPreferences` (Multi-tenant view preferences)
- `userSettings` (General user settings)

### AI Content Preferences

**Table:** `aiUserPreferences`

```typescript
{
  userId: number,
  
  // AI Help Settings
  preferredLanguage: 'en' | 'es' | ... (68 languages),
  aiHelpFrequency: 'never' | 'minimal' | 'moderate' | 'proactive',
  showSmartSuggestions: boolean,      // AI page suggestions
  showProactiveTips: boolean,         // Proactive help
  contextPreservation: boolean,       // Cross-page context
  
  // Learning Preferences
  learningPreferences: {
    // User's learning style preferences
    // (JSON field - flexible structure)
  },
  
  // Privacy Settings
  privacySettings: {
    shareJourneyData: boolean,        // Share usage patterns
    allowPersonalization: boolean,    // Allow AI personalization
    storeConversations: boolean       // Store AI chat history
  },
  
  // Favorites
  favoriteAgents: string[],           // Preferred Life CEO agents
  
  // Interaction Stats
  interactionHistory: {
    total: number,                    // Total AI interactions
    helpful: number,                  // Marked as helpful
    dismissed: number                 // Dismissed suggestions
  }
}
```

### Feed Content Preferences (Planned)

**Available via algorithm weights:**

```typescript
// Users can adjust feed emphasis
{
  temporalWeight: 0.5-1.5,     // Nostalgia vs recency
  socialWeight: 0.5-1.5,       // Friend content vs all
  emotionalWeight: 0.5-1.5,    // Emotional vs neutral
  contentWeight: 0.5-1.5       // Media-rich vs text
}

// Example: User wants more nostalgia, less social
{
  temporalWeight: 1.5,    // Emphasize "on this day"
  socialWeight: 0.5,      // De-emphasize friend content
  emotionalWeight: 1.0,   // Keep emotional balance
  contentWeight: 1.0      // Keep content balance
}
```

### View Preferences (Multi-Tenant)

**Table:** `userViewPreferences`

```typescript
{
  userId: number,
  viewMode: 'single_community' | 'multi_community',
  selectedTenantId: uuid,              // Current community
  selectedTenantIds: uuid[],           // Multiple communities
  customFilters: {
    // Custom filter preferences (JSON)
  }
}
```

### Content Filter Preferences

**Available in SmartPostFeed:**

```typescript
User can select:
  - Filter type: 'all' | 'residents' | 'visitors' | 'friends'
  - Tags: Multi-select from 15 categories
  - Date range: Start/end dates
  - Search: Text search

Saved per session (not persisted to DB yet)
```

### Notification Preferences

**Available in user settings:**

```typescript
{
  emailNotifications: boolean,
  pushNotifications: boolean,
  notificationFrequency: 'instant' | 'daily' | 'weekly',
  notifyOnMention: boolean,
  notifyOnComment: boolean,
  notifyOnLike: boolean,
  notifyOnFriendRequest: boolean
}
```

### Language Preferences

**Table:** `userLanguagePreferences`

```typescript
{
  userId: number,
  preferredLanguages: string[],       // 68 languages supported
  nativeLanguage: string,
  learningLanguages: string[],
  autoTranslate: boolean
}
```

### Memory Algorithm Preferences API

```typescript
GET /api/users/:id/memory-preferences
Returns current algorithm weights

PUT /api/users/:id/memory-preferences
Body: {
  temporalWeight: number,
  socialWeight: number,
  emotionalWeight: number,
  contentWeight: number,
  minimumScore: number
}
Updates user's algorithm weights
```

---

## âœ¨ COMPLETE FEATURE LIST

### PostCreator Features (1,731 lines)
âœ… 6 animated icon buttons with staggered entrance  
âœ… Hidden Gems recommendations (5 categories, 4 price ranges)  
âœ… 15 hashtag categories with emoji indicators  
âœ… Internal media upload (30 files, 500MB each)  
âœ… Image + video support with compression  
âœ… AI content enhancement (GPT-4o)  
âœ… 3 visibility levels (public/friends/private)  
âœ… @Mentions with autocomplete  
âœ… Google Maps location picker  
âœ… Rich text content  
âœ… Edit mode for existing posts  
âœ… Context-aware (feed/event/group)  
âœ… Progress tracking during upload  
âœ… Video thumbnail extraction  
âœ… Media preview with delete  
âœ… Keyboard shortcuts  
âœ… Responsive design  
âœ… Glassmorphic UI  
âœ… MT Ocean Theme gradients  

### SmartPostFeed Features (160 lines)
âœ… Real-time Socket.IO updates  
âœ… Search with 300ms debounce  
âœ… 4 filter types (all/residents/visitors/friends)  
âœ… Tag filtering (multi-select)  
âœ… Date range filtering  
âœ… Infinite scroll pagination  
âœ… Like/unlike posts  
âœ… Comment on posts  
âœ… Share posts  
âœ… Edit own posts  
âœ… Delete with confirmation  
âœ… Loading states  
âœ… Empty state message  
âœ… 20 posts per page  
âœ… Auto-load more on scroll  

### GlobalStatisticsDashboard Features (316 lines)
âœ… Total users with today's count  
âœ… Active cities count  
âœ… Total events with today's count  
âœ… Total connections  
âœ… Active tenants (global view)  
âœ… Top cities by user count  
âœ… Progress bar visualization  
âœ… Recent activity tab (24h stats)  
âœ… Multi-tenancy support  
âœ… 30-second auto-refresh  
âœ… 10-second real-time activity refresh  
âœ… Responsive grid layout  
âœ… Loading skeleton  

### UpcomingEventsSidebar Features (211 lines)
âœ… RSVP'd events section  
âœ… Your city events (3 max)  
âœ… Events you follow (3 max)  
âœ… Cities you follow (3 max)  
âœ… Collapsible sections  
âœ… Event count badges  
âœ… UnifiedEventCard display  
âœ… Real-time RSVP  
âœ… 4 event types (milonga/workshop/festival/practica)  
âœ… Attendee counts  
âœ… Date/time formatting  
âœ… Loading skeleton  

### Real-Time Features
âœ… Socket.IO connection  
âœ… Live status badge  
âœ… New post broadcasts  
âœ… Live like updates  
âœ… Live comment updates  
âœ… Toast notifications  
âœ… Auto cache invalidation  
âœ… Reconnection handling  

### Recommendations System
âœ… 5 recommendation categories  
âœ… 4 price range options  
âœ… Google Maps integration  
âœ… Business details (rating, address)  
âœ… Coordinate storage  
âœ… Glassmorphic panel UI  
âœ… Icon-based category selector  
âœ… Price range buttons  

### UI/UX Features
âœ… MT Ocean Theme glassmorphism  
âœ… Floating gradient orbs (3)  
âœ… Animated icon entrances  
âœ… Ripple effects on hover  
âœ… Magnetic button interactions  
âœ… Shimmer overlays  
âœ… Pulsing glow effects  
âœ… Scroll reveal animations  
âœ… Fade-in transitions  
âœ… Loading skeletons  
âœ… Dark mode support  
âœ… Responsive layout (2-column â†’ 1-column)  
âœ… Keyboard shortcuts (Ctrl+N, Ctrl+R, Esc)  
âœ… Accessibility (ARIA labels, roles)  
âœ… Internationalization (i18next)  

---

## ğŸ”Œ APIS & DATABASE

### API Endpoints Used

**Posts:**
```typescript
POST /api/posts                 // Create post (FormData)
POST /api/posts/direct          // Create post (JSON with URLs)
GET /api/posts/feed             // Get posts (paginated, filtered)
PATCH /api/posts/:id            // Update post
DELETE /api/posts/:id           // Delete post
```

**Media:**
```typescript
POST /api/upload                // Internal media upload
POST /api/upload/cloudinary     // Cloudinary upload
```

**Users:**
```typescript
GET /api/users/search?q=...     // @mention autocomplete
```

**Statistics:**
```typescript
GET /api/statistics/global      // Platform stats
GET /api/statistics/realtime    // 24h activity stats
```

**Events:**
```typescript
GET /api/events/feed            // Upcoming events
POST /api/events/:id/rsvp       // RSVP to event
```

**AI Enhancement:**
```typescript
POST /api/memories/enhance      // AI content improvement
```

### Database Tables

**Primary Table: `posts`**
```sql
CREATE TABLE posts (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  content TEXT NOT NULL,
  
  -- Media
  image_url TEXT,
  video_url TEXT,
  media_embeds TEXT[],
  
  -- Social
  likes_count INTEGER DEFAULT 0,
  comments_count INTEGER DEFAULT 0,
  shares_count INTEGER DEFAULT 0,
  
  -- Metadata
  hashtags TEXT[],
  is_public BOOLEAN DEFAULT true,
  location TEXT,
  
  -- Recommendations
  is_recommendation BOOLEAN DEFAULT false,
  recommendation_type TEXT,
  price_range TEXT,
  
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP
);
```

**Related Tables:**
- `users` - User profiles
- `post_likes` - Like tracking
- `post_comments` - Comments
- `post_shares` - Shares
- `events` - Tango events
- `event_rsvps` - Event RSVPs
- `media_assets` - Media file metadata

### Socket.IO Events

**Outgoing (Client â†’ Server):**
```typescript
'memory:created' - New post created
'memory:liked' - Post liked
'typing:start' - User typing
'typing:stop' - User stopped typing
```

**Incoming (Server â†’ Client):**
```typescript
'memory:new' - New post broadcast
'memory:updated' - Post edited
'memory:liked' - Like notification
'memory:commented' - Comment notification
'user:online' - User came online
'user:offline' - User went offline
```

---

## ğŸ¯ USER FLOWS

### 1. Create Basic Post
1. User types content in PostCreator
2. (Optional) Adds hashtags via Tags button
3. (Optional) Sets visibility via Visibility button
4. Clicks Share Memory button
5. **API:** `POST /api/posts` (FormData)
6. Feed refreshes with new post
7. Socket.IO broadcasts to other users
8. Toast confirms "Memory shared successfully"

### 2. Create Recommendation
1. User clicks Hidden Gems button (ğŸ—ºï¸)
2. Recommendation panel slides in
3. Selects category (e.g., Restaurant)
4. Selects price range (e.g., $$)
5. Uses location picker to select place
6. Writes review/description
7. Clicks Share Memory
8. **API:** `POST /api/posts` with recommendation data
9. Post marked as recommendation
10. Appears in recommendations feed + map

### 3. Upload Media
1. User clicks Camera button (ğŸ“·)
2. File picker opens (30 files, 500MB each)
3. Selects images/videos
4. Upload begins with progress bar
5. Videos auto-generate thumbnails
6. Previews appear with X button to remove
7. User writes caption
8. Clicks Share Memory
9. **API:** `POST /api/upload` â†’ `POST /api/posts/direct`
10. Media URLs saved with post

### 4. AI Enhancement
1. User writes content
2. Clicks AI Enhancement button (âœ¨)
3. Button animates (spin effect)
4. **API:** `POST /api/memories/enhance`
5. AI analyzes content and returns:
   - Enhanced content
   - Generated tags
   - Sentiment analysis
   - Suggestions
6. Preview shows enhanced version
7. User can accept or reject
8. If accepted, enhanced content replaces original

### 5. Filter & Search Feed
1. User types in search box
2. 300ms debounce triggers
3. **API:** `GET /api/posts/feed?search=...`
4. Feed re-renders with results
5. User adds tag filter (e.g., #Travel)
6. **API:** `GET /api/posts/feed?tags=travel`
7. Feed shows only travel posts
8. User selects "Friends" filter
9. **API:** `GET /api/posts/feed?filterType=friends`
10. Feed shows only friends' posts

### 6. RSVP to Event
1. User sees event in sidebar
2. Clicks "Going" button
3. **API:** `POST /api/events/:id/rsvp`
4. Button updates to "Going âœ“"
5. Event moves to "RSVP'd Events" section
6. Attendee count increments
7. Socket.IO notifies event organizer

### 7. Edit Post
1. User sees their own post
2. Clicks edit button (âœï¸)
3. Edit modal opens with PostCreator in edit mode
4. Pre-filled with existing content/media
5. User makes changes
6. Clicks "Save Changes"
7. **API:** `PATCH /api/posts/:id`
8. Modal closes
9. Feed refreshes
10. Toast: "Memory updated"

---

## ğŸ“± RESPONSIVE BEHAVIOR

### Desktop (1024px+)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Main Feed  â”‚  Sidebar   â”‚
â”‚   (Wide)     â”‚  (380px)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- 2-column layout
- Sidebar visible
- Full icon tooltips
- Keyboard shortcuts shown

### Tablet (768px - 1023px)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Main Feed  â”‚
â”‚   (Full)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- 1-column layout
- Sidebar hidden
- Responsive grids (3 â†’ 2 â†’ 1)
- Touch-optimized buttons

### Mobile (< 768px)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Feed  â”‚
â”‚(Stack) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- Single column
- Stacked layout
- Larger touch targets
- Simplified UI
- Bottom sheet modals

---

## ğŸ¨ MT OCEAN THEME DESIGN

### Color Palette
```css
/* Gradients */
--ocean-gradient: linear-gradient(135deg, 
  hsl(173 80% 64%) 0%,   /* cyan-300 */
  hsl(177 72% 56%) 25%,  /* turquoise */
  hsl(180 64% 50%) 50%,  /* cyan-500 */
  hsl(194 53% 27%) 75%,  /* ocean-700 */
  hsl(173 80% 64%) 100%  /* cyan-300 */
);

/* Glassmorphism */
background: rgba(255, 255, 255, 0.7);
backdrop-filter: blur(20px);
border: 1px solid rgba(255, 255, 255, 0.4);
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
```

### Floating Orbs (3)
**Orb 1 (Cyan):**
- Size: 96x96 (24rem)
- Position: top-20 left-10
- Animation: 8s float
- Color: cyan-400/20

**Orb 2 (Blue):**
- Size: 80x80 (20rem)
- Position: top-40 right-20
- Animation: 10s float (2s delay)
- Color: blue-400/20

**Orb 3 (Teal):**
- Size: 72x72 (18rem)
- Position: bottom-20 left-1/3
- Animation: 12s float (4s delay)
- Color: teal-400/20

### Glassmorphic Elements
- **Cards:** Frosted glass effect
- **Borders:** Semi-transparent + gradient
- **Shadows:** Soft + colored (cyan/blue)
- **Blur:** 20px backdrop blur
- **Overlays:** Grid pattern (5% opacity)

### Animations
```css
/* Float Animation */
@keyframes float {
  0%, 100% { transform: translateY(0) translateX(0); }
  25% { transform: translateY(-20px) translateX(10px); }
  50% { transform: translateY(-10px) translateX(-10px); }
  75% { transform: translateY(-30px) translateX(5px); }
}

/* Sparkle Twinkle */
@keyframes sparkle-twinkle {
  0%, 100% { transform: rotate(0) scale(1); opacity: 1; }
  50% { transform: rotate(180deg) scale(1.2); opacity: 0.8; }
}

/* Globe Spin */
@keyframes globe-spin {
  from { transform: rotateY(0deg); }
  to { transform: rotateY(360deg); }
}

/* Camera Shutter */
@keyframes camera-shutter {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(0.8); }
}

/* Send Fly */
@keyframes send-fly {
  0% { transform: translateX(0) translateY(0); }
  100% { transform: translateX(10px) translateY(-10px); }
}
```

---

## âŒ¨ï¸ KEYBOARD SHORTCUTS

```
Ctrl+N (Cmd+N) - Focus on PostCreator
Ctrl+R (Cmd+R) - Refresh feed
Escape - Close modals
```

**Header Badge:** Shows "Ctrl+N - New Post" hint (desktop only)

---

## ğŸŒ INTERNATIONALIZATION

All text uses `react-i18next`:

**Translation Keys:**
```typescript
// Header
t('memories.title')                  // "Memories"
t('memories.keyboardShortcuts')      // Accessibility label
t('memories.newPost')               // "New Post"

// PostCreator
t('postCreator.hiddenGems')         // "Hidden Gems"
t('postCreator.addTags')            // "Add Tags"
t('postCreator.uploadMediaTitle')   // "Upload Media"
t('postCreator.aiEnhance')          // "AI Enhance"
t('postCreator.visibilityTitle')    // "Visibility"
t('postCreator.shareMemory')        // "Share Memory"

// Categories
t('memories.categories.travel')     // "Travel"
t('memories.categories.food')       // "Food"
// ... 15 total

// Feed
t('memories.feed.confirmDelete')    // "Are you sure?"
t('memories.memoryShared')          // "Memory shared!"
t('memories.error')                 // "Error"

// Events
t('events.upcomingEvents')          // "Upcoming Events"
t('events.loadingEvents')           // "Loading events..."
```

**Supported Languages:** 68 total

---

## ğŸ”’ SECURITY & PERMISSIONS

### CSRF Protection
All POST/PATCH/DELETE requests include CSRF token:
```typescript
const { csrfToken } = useCsrfToken();
headers: { 'X-CSRF-Token': csrfToken }
```

### Authentication
- Required for all mutations
- Auth context provides user
- Posts owned by authenticated user
- Edit/delete only for own posts

### Content Moderation
- XSS prevention (sanitized input)
- File type validation
- File size limits (500MB)
- Rate limiting on uploads

---

## ğŸš€ PERFORMANCE OPTIMIZATIONS

### React Query
- 30-second stale time for stats
- Infinite query for feed pagination
- Optimistic updates for likes
- Cache invalidation on mutations
- Structural sharing disabled for real-time

### Debouncing
- Search: 300ms debounce
- Scroll: throttled infinite scroll

### Lazy Loading
- UpcomingEventsSidebar: lazy loaded
- ShareModal: lazy loaded with Suspense
- Images: loading="lazy"

### Code Splitting
- Lazy component imports
- Dynamic imports for modals
- Separate chunks for routes

### Media Optimization
- Client-side image compression
- Video thumbnail extraction
- Preview before upload
- CDN for uploaded media

---

## ğŸ¯ SUMMARY

### What Works
âœ… **2,654+ lines** of production-ready code  
âœ… **Universal PostCreator** with 6 animated buttons  
âœ… **Real-time social feed** with Socket.IO  
âœ… **Platform statistics** dashboard  
âœ… **Event management** with RSVP  
âœ… **Recommendations system** with 5 categories  
âœ… **AI enhancement** with GPT-4o  
âœ… **Media upload** (30 files, 500MB each)  
âœ… **Search & filtering** with debounce  
âœ… **Infinite scroll** pagination  
âœ… **MT Ocean Theme** glassmorphic design  
âœ… **Keyboard shortcuts**  
âœ… **Dark mode** support  
âœ… **68 languages** i18n  
âœ… **Responsive** layout  
âœ… **Resilient** error boundaries  

### Key Files

```
client/src/pages/ESAMemoryFeed.tsx                      577 lines
client/src/components/universal/PostCreator.tsx       1,731 lines
client/src/components/moments/SmartPostFeed.tsx         160 lines
client/src/components/GlobalStatisticsDashboard.tsx     316 lines
client/src/components/esa/UpcomingEventsSidebar.tsx     211 lines
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL                                                  2,995 lines
```

### APIs Used

```
/api/posts                    - Posts CRUD
/api/posts/feed               - Get feed
/api/upload                   - Media upload
/api/memories/enhance         - AI enhancement
/api/users/search             - @mention autocomplete
/api/statistics/global        - Platform stats
/api/statistics/realtime      - Activity stats
/api/events/feed              - Events list
/api/events/:id/rsvp          - RSVP to event
```

### Database

```
posts                         - Main table
users                         - User profiles
post_likes                    - Likes
post_comments                 - Comments
events                        - Tango events
event_rsvps                   - RSVPs
media_assets                  - Media files
```

---

**END OF COMPLETE HANDOFF**

**This document contains everything that exists on the Memory Feed page as of November 6, 2025, based on direct code inspection from GitHub branch `conflict_100925_1852`.**

Any developer can rebuild this page from scratch using this documentation alone. ğŸ‰