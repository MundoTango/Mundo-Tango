name: Auto-Sync to GitHub

on:
  schedule:
    # Run every 6 hours
    - cron: '0 */6 * * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Configure Git
        run: |
          git config --global user.name "Mundo Tango Bot"
          git config --global user.email "admin@mundotango.life"
      
      - name: Check for Remote Changes
        id: check_changes
        run: |
          git fetch origin main
          BEHIND=$(git rev-list HEAD..origin/main --count)
          AHEAD=$(git rev-list origin/main..HEAD --count)
          echo "behind=$BEHIND" >> $GITHUB_OUTPUT
          echo "ahead=$AHEAD" >> $GITHUB_OUTPUT
          echo "Remote is $BEHIND commits ahead, local is $AHEAD commits ahead"
      
      - name: Pull Remote Changes
        if: steps.check_changes.outputs.behind > 0
        run: |
          git pull origin main --rebase
      
      - name: Push Local Changes
        if: steps.check_changes.outputs.ahead > 0
        run: |
          git push origin main
      
      - name: Sync Status
        run: |
          echo "âœ… Sync complete!"
          echo "Repository is now in sync with GitHub"
